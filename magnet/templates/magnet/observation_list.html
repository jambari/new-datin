{% extends "base.html" %}

{% block content %}
<div class="flex h-screen bg-gray-100">
  {% include 'partials/_sidebar.html' %}
  <div class="flex-1 flex flex-col overflow-hidden">
    {% include 'partials/_topbar.html' %} 
    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-8">
      <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold text-gray-900">Magnetic Observation Records</h1>
        <a href="{% url 'observation_form' %}" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-md hover:bg-indigo-700 text-sm">
          + New Observation
        </a>
      </div>

      <div class="mt-8 bg-white shadow rounded-lg overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Observer</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Session</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for obs in observations %}
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ obs.observation_date }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ obs.observer }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ obs.session }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                <a href="{% url 'observation_detail' pk=obs.pk %}"
                class="px-3 py-1 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 transition">
                View
                </a>

                <a href="{% url 'observation_edit' pk=obs.pk %}"
                class="px-3 py-1 rounded-md bg-green-600 text-white hover:bg-green-700 transition">
                Edit
                </a>

                <a href="{% url 'trigger_single_automation' pk=obs.pk %}"
                class="px-3 py-1 rounded-md text-white transition inline-block"
                style="background-color: #f59e0b;">
                Run Automation
                </a>


                <a href="{% url 'observation_delete' pk=obs.pk %}"
                class="px-3 py-1 rounded-md bg-red-600 text-white hover:bg-red-700 transition">
                Delete
                </a>

              </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="text-center py-10">No records found. Start by creating a new observation.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="pagination mt-6 flex justify-center items-center">
          <span class="step-links">
              {% if observations.has_previous %}
                  <a href="?page=1" class="px-3 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">&laquo; first</a>
                  <a href="?page={{ observations.previous_page_number }}" class="px-3 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">previous</a>
              {% endif %}

              <span class="current-page px-4 py-2 text-sm font-medium text-gray-700">
                  Page {{ observations.number }} of {{ observations.paginator.num_pages }}.
              </span>

              {% if observations.has_next %}
                  <a href="?page={{ observations.next_page_number }}" class="px-3 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">next</a>
                  <a href="?page={{ observations.paginator.num_pages }}" class="px-3 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">last &raquo;</a>
              {% endif %}
          </span>
      </div>
    </main>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');

    if (sidebarToggle) {
      sidebarToggle.addEventListener('click', function() {
        // This toggles the 'hidden' class on the sidebar for mobile
        sidebar.classList.toggle('hidden');
      });
    }
  });
</script>
{% endblock %}