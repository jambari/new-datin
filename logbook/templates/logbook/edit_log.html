{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="flex h-screen bg-gray-100 overflow-hidden">
    {% include 'partials/_sidebar.html' %}

    <div class="flex-1 flex flex-col overflow-hidden">
        {% include 'partials/_topbar.html' %}

        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-8">
            <style>
                .compact-container { max-width: 850px; margin: 0 auto; width: 95%; font-family: sans-serif; }
                .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 5px solid #ffc107; }
                .form-label { font-size: 0.9rem; font-weight: 600; color: #374151; margin-bottom: 4px; display: block; }
                .form-control { width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.9rem; box-sizing: border-box; }
                .form-group { margin-bottom: 15px; }

                /* --- CSS STANDAR UNTUK TOMBOL (NON-TAILWIND) --- */
                .btn-save-std { 
                    background-color: #ffc107; 
                    color: #000; 
                    border: none; 
                    padding: 12px; 
                    border-radius: 6px; 
                    width: 100%; 
                    font-weight: bold; 
                    cursor: pointer; 
                    font-size: 16px; 
                    transition: 0.2s;
                }
                .btn-save-std:hover { background-color: #e0a800; }
                
                .btn-back-std { 
                    display: inline-flex; 
                    align-items: center; 
                    margin-bottom: 20px; 
                    text-decoration: none; 
                    color: #4b5563; 
                    font-weight: 500; 
                    transition: color 0.2s;
                }
                .btn-back-std:hover { color: #111827; }

                /* --- GRID PETUGAS HORIZONTAL --- */
                #div_petugas_sebelum ul, #div_petugas_selanjutnya ul {
                    display: grid !important;
                    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)) !important;
                    gap: 10px !important;
                    list-style: none !important;
                    padding: 15px !important;
                    background: #f9fafb;
                    border: 1px solid #e5e7eb;
                    border-radius: 8px;
                    margin-top: 5px !important;
                }
                #div_petugas_sebelum li, #div_petugas_selanjutnya li { display: flex !important; align-items: center !important; }
                #div_petugas_sebelum input, #div_petugas_selanjutnya input { margin-right: 8px !important; width: 18px; height: 18px; cursor: pointer; }
                #div_petugas_sebelum label, #div_petugas_selanjutnya label { font-size: 0.85rem !important; font-weight: normal !important; color: #334155; white-space: nowrap !important; cursor: pointer; }
                
                .hv-box { background-color: #fdfaf0; border: 1px solid #fbd38d; border-radius: 8px; padding: 15px; margin: 15px 0; border-left: 4px solid #f6ad55; }
                .hidden { display: none; }
            </style>

            <div class="compact-container">
                <a href="{% url 'logbook:logbook_list' %}" class="btn-back-std">
                    <svg style="width: 20px; height: 20px; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg> 
                    Kembali ke Daftar Log
                </a>

                <div class="card">
                    <h2 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 5px; color: #1f2937;">Edit Logbook</h2>
                    <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 25px; border-bottom: 1px solid #e5e7eb; padding-bottom: 10px;">
                        Tanggal Log: {{ log_entry.tanggal|date:"d F Y" }}
                    </p>

                    <form method="POST">
                        {% csrf_token %}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 form-group">
                            <div><label class="form-label">Shift</label>{{ form.shift }}</div>
                            <div><label class="form-label">Status Absen</label>{{ form.status_absen }}</div>
                        </div>

                        <div id="div_petugas_sebelum" class="form-group"><label class="form-label">Petugas Sebelumnya</label>{{ form.petugas_sebelum }}</div>
                        <div id="div_petugas_selanjutnya" class="form-group hidden"><label class="form-label">Petugas Selanjutnya</label>{{ form.petugas_selanjutnya }}</div>

                        {% if show_hv_fields %}
                            <div class="hv-box">
                                <h3 style="font-size: 0.75rem; font-weight: bold; color: #9c4221; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.05em;">Data HV Sampler</h3>
                                <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                                    <div><label class="form-label" style="font-size: 11px;">Counter Hour</label>{{ form.hv_counter_hour }}</div>
                                    <div><label class="form-label" style="font-size: 11px;">Flow Rate</label>{{ form.hv_flow_rate }}</div>
                                    <div><label class="form-label" style="font-size: 11px;">Berat Kertas (gr)</label>{{ form.hv_berat_kertas }}</div>
                                    <div><label class="form-label" style="font-size: 11px;">Jam Pasang</label>{{ form.hv_jam_pasang }}</div>
                                    <div><label class="form-label" style="font-size: 11px;">Jam Angkat</label>{{ form.hv_jam_angkat }}</div>
                                </div>
                            </div>
                        {% endif %}

                        <hr style="margin: 25px 0; border: 0; border-top: 1px solid #e5e7eb;">
                        
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 form-group">
                            {% for field in form %}
                                {% if field.name not in 'shift status_absen petugas_sebelum petugas_selanjutnya catatan hv_counter_hour hv_flow_rate hv_berat_kertas hv_jam_pasang hv_jam_angkat' %}
                                <div><label class="form-label" style="font-size: 0.75rem;">{{ field.label }}</label>{{ field }}</div>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <div class="form-group" style="margin-top: 20px;"><label class="form-label">Catatan</label>{{ form.catatan }}</div>
                        <button type="submit" class="btn-save-std">Simpan Perubahan Logbook</button>
                    </form>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const statusField = document.getElementById('id_status_absen');
        const divSebelum = document.getElementById('div_petugas_sebelum');
        const divSelanjutnya = document.getElementById('div_petugas_selanjutnya');

        function toggleFields() {
            if (statusField && statusField.value === 'Masuk') {
                divSebelum.classList.remove('hidden');
                divSelanjutnya.classList.add('hidden');
            } else if (statusField) {
                divSebelum.classList.add('hidden');
                divSelanjutnya.classList.remove('hidden');
            }
        }
        if (statusField) {
            toggleFields();
            statusField.addEventListener('change', toggleFields);
        }
    });
</script>
{% endblock %}