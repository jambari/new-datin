{% extends "base.html" %}
{% load static %}
{% load tz %}

{% block content %}
<div class="flex h-screen bg-gray-100">
  
  <style>
      .compact-container { max-width: 1000px; margin: 0 auto; width: 95%; }

      /* --- PERBAIKAN CSS HORIZONTAL (STRATEGI BARU) --- */
      #div_petugas_sebelum div, #div_petugas_selanjutnya div {
          display: block !important;
      }
      
      /* Target langsung ke tag UL yang dibuat Django */
      #div_petugas_sebelum ul, #div_petugas_selanjutnya ul {
          display: flex !important;
          flex-direction: row !important;
          flex-wrap: wrap !important; /* Supaya otomatis baris baru jika penuh */
          gap: 10px 25px !important;
          list-style: none !important;
          padding: 15px !important;
          margin: 10px 0 !important;
          background: #f8fafc;
          border: 1px solid #e2e8f0;
          border-radius: 8px;
          width: 100% !important;
      }
      
      #div_petugas_sebelum li, #div_petugas_selanjutnya li {
          display: inline-flex !important;
          align-items: center !important;
          margin: 0 !important;
          padding: 0 !important;
      }

      #div_petugas_sebelum input[type="checkbox"], 
      #div_petugas_selanjutnya input[type="checkbox"] {
          margin-right: 8px !important;
          width: 18px !important;
          height: 18px !important;
          cursor: pointer !important;
      }

      #div_petugas_sebelum label, #div_petugas_selanjutnya label {
          font-size: 0.85rem !important;
          font-weight: normal !important;
          cursor: pointer !important;
          display: flex !important;
          align-items: center !important;
      }
      /* --- END STYLING --- */

      .form-group { margin-bottom: 12px; }
      .form-label { font-size: 0.9rem; font-weight: 600; color: #374151; margin-bottom: 4px; display: block; }
      .form-control { width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.9rem; }
      .btn-custom-submit { background-color: #198754 !important; color: white !important; padding: 10px; border-radius: 6px; font-weight: bold; width: 100%; border: none; cursor: pointer; }
      .hv-box { background-color: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin: 15px 0; }
  </style>

  {% include 'partials/_sidebar.html' %}

  <div class="flex-1 flex flex-col overflow-hidden">
    {% include 'partials/_topbar.html' %} 

    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-4">
        <div class="compact-container">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">Logbook Harian</h1>

            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-lg font-bold mb-4 text-gray-700 border-b pb-2">Input Log Baru</h2>
                
                <form method="POST">
                    {% csrf_token %}
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 form-group">
                        <div><label class="form-label">Shift</label>{{ form.shift }}</div>
                        <div><label class="form-label">Status Absen</label>{{ form.status_absen }}</div>
                    </div>

                    <div id="div_petugas_sebelum" class="form-group">
                        <label class="form-label">Petugas Shift Sebelumnya (Bisa pilih > 1)</label>
                        {{ form.petugas_sebelum }}
                    </div>

                    <div id="div_petugas_selanjutnya" class="form-group hidden">
                        <label class="form-label">Petugas Shift Selanjutnya (Bisa pilih > 1)</label>
                        {{ form.petugas_selanjutnya }}
                    </div>

                    {% if show_hv_fields %}
                        <div class="hv-box">
                            <h3 class="text-sm font-bold text-gray-700 mb-3 uppercase">Data HV Sampler: {% if hv_today %}Pemasangan{% else %}Pengangkatan{% endif %}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div><label class="form-label text-xs">Counter Hour</label>{{ form.hv_counter_hour }}</div>
                                <div><label class="form-label text-xs">Flow Rate</label>{{ form.hv_flow_rate }}</div>
                                <div><label class="form-label text-xs">Berat Kertas (gr)</label>{{ form.hv_berat_kertas }}</div>
                            </div>
                        </div>
                    {% endif %}

                    <hr class="my-4 border-gray-100">

                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 form-group">
                        {% for field in form %}
                            {% if field.name not in 'shift status_absen petugas_sebelum petugas_selanjutnya catatan hv_counter_hour hv_flow_rate hv_berat_kertas' %}
                            <div><label class="form-label text-xs">{{ field.label }}</label>{{ field }}</div>
                            {% endif %}
                        {% endfor %}
                    </div>

                    <div class="form-group mt-4"><label class="form-label">Catatan</label>{{ form.catatan }}</div>
                    <button type="submit" class="btn-custom-submit mt-4">Simpan Log</button>
                </form>
            </div>
        </div>
    </main>
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const statusField = document.getElementById('id_status_absen');
        const divSebelum = document.getElementById('div_petugas_sebelum');
        const divSelanjutnya = document.getElementById('div_petugas_selanjutnya');

        function toggleFields() {
            if (statusField.value === 'Masuk') {
                divSebelum.classList.remove('hidden');
                divSelanjutnya.classList.add('hidden');
                // Uncheck yang tidak aktif
                divSelanjutnya.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            } else if (statusField.value === 'Pulang') {
                divSebelum.classList.add('hidden');
                divSelanjutnya.classList.remove('hidden');
                // Uncheck yang tidak aktif
                divSebelum.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
        }
        toggleFields();
        statusField.addEventListener('change', toggleFields);
    });
</script>
{% endblock %}